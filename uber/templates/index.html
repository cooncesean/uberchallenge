<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <title>Fog City Flicks</title>
    <link href="{{ url_for('static', filename='css/uber.css') }}" rel="stylesheet">
    <link href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css" rel="stylesheet">
  </head>

  <body>
    <div id="container">
      <div id="sidebar">
        Filter These Results
      </div>
      <div id="content">
        <div id="map-canvas"></div>
      </div>
    </div>

    <script src="//maps.googleapis.com/maps/api/js?key={{ GOOGLE_MAP_API_KEY }}&sensor=false" type="text/javascript" ></script>

    {# Google Maps Initialization #}
    <script type="text/javascript">
      function initialize() {
        var mapOptions = {
          center: new google.maps.LatLng(37.7533, -122.4173),
          zoom: 12,
          mapTypeId: google.maps.MapTypeId.ROADMAP
        };
        var map = new google.maps.Map(
          document.getElementById("map-canvas"),
          mapOptions
        );
        var infowindow = new google.maps.InfoWindow();

        // Create the initial markers
        {% for movie in movies %}
          {% for lat_long in movie.geolocation %}
            marker = new google.maps.Marker({
              map: map,
              position: new google.maps.LatLng({{ lat_long.lat }}, {{ lat_long.lng }}),
              title:  "{{ movie.title }}",
              clickable: true
            });

            // Attach click events to each marker binding it to an info window
            var infowindow = new google.maps.InfoWindow({content: ''});
            bindInfoWindow(marker, map, infowindow, "{{ movie.format_info|safe }}", '{{ movie.title }}' );
            function bindInfoWindow(marker, map, infowindow, html, Ltitle) {
              google.maps.event.addListener(marker, 'mouseover', function() {
                infowindow.setContent(html);
                infowindow.open(map, marker);
              });
              google.maps.event.addListener(marker, 'mouseout', function() {
                infowindow.close();
              });
            }

          {% endfor %}
        {% endfor %}
      }
      google.maps.event.addDomListener(window, 'load', initialize);
    </script>
  </body>
</html>